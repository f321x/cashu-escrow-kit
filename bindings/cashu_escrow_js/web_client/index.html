<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Escrow Web Client</title>
  </head>
  <body>
    <noscript>This page contains webassembly and javascript content, please enable javascript in your browser.</noscript>
    <script src="./bootstrap.js"></script>

    <script>
      let wallet;
      const intervalId =setInterval(function() {
        if (typeof app === 'object') {
          app.createWallet().then(w => {
            document.getElementById('trade_public_key').textContent = w.tradePublicKey;
            wallet = w;
          });
          clearInterval(intervalId);
        } else {
          console.error('createWallet function not found');
        }  
      }, 1000);
    </script>

    <script>
      function runTradePipeline() {
        const role = document.getElementById('role').value;
        const partnerPublicKey = document.getElementById('partner_public_key').value;
        app.runTradePipeline(role, wallet, partnerPublicKey);
      }
    </script>

    <h1>Escrow Web Client</h1>
    <h2>Your trade public key is:</h2>
    <div id="trade_public_key"></div>
    <h2>Please enter your role in the trade (buyer or seller) and public key of your partner</h2>
    
    <div style="margin: 10px;">
      <label for="role">Role:</label>
      <input type="text" id="role" name="role" placeholder="buyer or seller">
    </div>
      
    <div style="margin: 10px;">
      <label for="partner_public_key">Partner Public Key:</label>
      <input type="text" id="partner_public_key" name="partner_public_key" placeholder="Public Key" style="width: 500px;">
    </div>

    <div style="margin: 10px;">
      <button id="start_button" onclick="runTradePipeline()">Start</button>
    </div>
  </body>
</html>
